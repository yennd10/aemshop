<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Parallax bằng JavaScript</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font:16px/1.5 system-ui, sans-serif;color:#fff;background:#111;}

  .hero {
    position: relative;
    overflow: hidden;
    background: #000;
    border: 2px solid #fff;
    width: 100%;
  }

  .wrap-layer {
    position: relative;
    height: 600px;
    overflow-y: auto;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  .wrap-layer::-webkit-scrollbar {
    display: none; /* Chrome, Safari and Opera */
  }

  .wrap-layer::-webkit-scrollbar-track {
    background: #f1f1f1;
  }

  .wrap-layer::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }

  .wrap-layer::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  .layer {
    position: absolute;
    inset: 0;
    will-change: transform, opacity; /* tối ưu GPU */
    transition: opacity 0.3s ease-out;
    height: 900px; /* Tạo chiều cao để có thể scroll */
  }
  
  .layer img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Layer 1 - Background (xa nhất) */
  .layer[data-speed="0.65"] { 
    border-color: rgba(255,0,0,1);
  }
  
  /* Layer 2 - Middle */
  .layer[data-speed="0.35"] { 
    border-color: rgba(0,255,0,1);
  }
  
  /* Layer 3 - Foreground (gần nhất) */
  .layer[data-speed="0.15"] { 
    border-color: rgba(0,0,255,1);
  }

  .content {
    position: relative;
    z-index: 10;
    display: grid;
    place-items: center;
    height: 100%;
    text-align: center;
    padding: 2rem;
    background: rgba(0,0,0,0.3);
    border-radius: 20px;
  }

  section {
    padding: 6rem 1.25rem;
    margin: auto;
  }

  @media (prefers-reduced-motion: reduce) {
    .layer { transform: none !important; }
  }
</style>
</head>
<body>
  <!-- Khối hero với parallax -->
  <section class="hero" id="scene">
    <div class="wrap-layer">
        <div class="layer" data-speed="0.65">
        <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600" alt="">
        </div>
        <div class="layer" data-speed="0.35">
        <img src="https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1600" alt="">
        </div>
        <div class="layer" data-speed="0.15">
        <img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1600" alt="">
        </div>
    </div>
  </header>

  <!-- Nội dung sau hero -->
  <section>
    <h2>Nội dung tiếp theo</h2>
    <p>
      Đây là phần chữ/ảnh thường. Bạn có thể chèn thêm section khác để
      tạo trang web dài hơn và cảm nhận rõ hiệu ứng parallax.
    </p>
  </section>

  <script>
    (() => {
      const scene = document.getElementById('scene');
      const layers = Array.from(scene.querySelectorAll('.layer'));
      let ticking = false;

      function update() {
        const wrapLayer = document.querySelector('.wrap-layer');
        const scrollTop = wrapLayer.scrollTop;
        const scrollHeight = wrapLayer.scrollHeight - wrapLayer.clientHeight;
        const progress = scrollHeight > 0 ? scrollTop / scrollHeight : 0;
        
        // dịch chuyển từng layer theo hệ số speed và thay đổi opacity
        layers.forEach((layer, index) => {
          const speed = parseFloat(layer.dataset.speed || 0.3);
          
          // Transform cho hiệu ứng parallax - mỗi layer có chuyển động khác nhau
          if (index === 0) {
            // Layer 1 (background) - di chuyển chậm nhất, lên trên
            const translateY = progress * -30 * speed;
            layer.style.transform = `translateY(${translateY}px)`;
          } else if (index === 1) {
            // Layer 2 (middle) - di chuyển trung bình, sang phải
            const translateY = progress * 20 * speed;
            const translateX = progress * 15 * speed;
            layer.style.transform = `translateY(${translateY}px) translateX(${translateX}px)`;
          } else {
            // Layer 3 (foreground) - di chuyển nhanh nhất, xuống dưới
            const translateY = progress * 40 * speed;
            const translateX = progress * -10 * speed;
            layer.style.transform = `translateY(${translateY}px) translateX(${translateX}px)`;
          }
          
          // Opacity để tạo hiệu ứng fade in/out 3 giai đoạn trong wrap-layer
          if (index === 0) {
            // Layer 1 - ẩn dần trong giai đoạn 1 (progress 0 -> 0.33)
            if (progress <= 0.33) {
              layer.style.opacity = 1 - (progress * 3); // 1 -> 0
            } else {
              layer.style.opacity = 0; // ẩn hoàn toàn
            }
          } else if (index === 1) {
            // Layer 2 - hiện dần trong giai đoạn 1 (0 -> 0.33), hiện rõ trong giai đoạn 2 (0.33 -> 0.66), ẩn dần trong giai đoạn 3 (0.66 -> 1)
            if (progress <= 0.33) {
              layer.style.opacity = progress * 3; // 0 -> 1
            } else if (progress <= 0.66) {
              layer.style.opacity = 1; // hiện rõ hoàn toàn
            } else {
              layer.style.opacity = 1 - ((progress - 0.66) * 3); // 1 -> 0
            }
          } else {
            // Layer 3 - hiện dần trong giai đoạn 3 (0.66 -> 1)
            if (progress <= 0.66) {
              layer.style.opacity = 0; // ẩn hoàn toàn
            } else {
              layer.style.opacity = (progress - 0.66) * 3; // 0 -> 1
            }
          }
        });
        
        ticking = false;
      }

      function onScroll() {
        if (!ticking) {
          window.requestAnimationFrame(update);
          ticking = true;
        }
      }

      // Thêm event listener cho scroll trong wrap-layer
      const wrapLayer = document.querySelector('.wrap-layer');
      wrapLayer.addEventListener('scroll', onScroll, { passive: true });
      window.addEventListener('resize', onScroll);
      update();
    })();
  </script>
</body>
</html>
